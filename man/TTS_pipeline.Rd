% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/TopTreeSegR.R
\name{TTS_pipeline}
\alias{TTS_pipeline}
\title{Complete Tree Segmentation Pipeline with Bayesian Refinement}
\usage{
TTS_pipeline(
  las,
  method = "morse-smale",
  alpha = 0.1,
  input_truth = "pid",
  stem_height = 0.5,
  spatial_eps = 1,
  cores = 2,
  prior_strength = 1,
  likelihood_strength = 1.6,
  confidence_threshold = 1,
  fix_fragments = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{las}{Input LAS point cloud (must contain X, Y, Z coordinates)}

\item{method}{Segmentation method: "morse-smale" (default) or "gradient"}

\item{alpha}{Alpha parameter for alpha-complex construction (default: 0.1)}

\item{input_truth}{Attribute from las (default: "pid")}

\item{stem_height}{Height threshold for detecting stem seeds (default: 0.5)}

\item{spatial_eps}{Spatial epsilon for clustering minima (default: 1.0)}

\item{cores}{Number of CPU threads for parallel processing (default: 2)}

\item{prior_strength}{Spatial consistency strength in Bayesian refinement.
Controls how much points should match their neighbors' labels.
Range: 0.5 (weak) to 2.0 (strong). Default: 1.0 (moderate).}

\item{likelihood_strength}{Elevation consistency strength in Bayesian refinement.
Controls how much points at similar heights should have same label.
\strong{This is an exponent}: 1.0 = moderate, 1.5 = strong, 2.0 = very strong.
Range: 0.5 to 2.5. Default: 1.6 (optimized for high ARI).}

\item{confidence_threshold}{How much better a new label must be to change.
Higher values = more conservative refinement (changes fewer labels).
\itemize{
\item 1.0: Change if new label is ANY better (even 0.0001\% better)
\item 1.3: Change only if new label is 30\% better
\item 1.5: Change only if new label is 50\% better
\item 2.0: Change only if new label is 100\% better (twice as good)
Range: 1.0 to 2.0. Default: 1.0 (aggressive, good for first pass).
}}

\item{fix_fragments}{Remove tiny fragments after refinement (default: TRUE)
Merges clusters with < 30 points into neighboring trees.}

\item{verbose}{Print progress messages (default: TRUE)}
}
\value{
A TTS_result object with the following components:
\itemize{
\item \code{labels}: Refined tree labels for mesh vertices
\item \code{original_pid}: Original point IDs from mesh
\item \code{mesh_coords}: Mesh vertices coordinates
\item \code{n_trees}: Number of trees detected
\item \code{minima}: Indices of Morse minima
\item \code{seeds}: Seed minima used
\item \code{method}: Method used for segmentation
\item \code{pipeline}: List of pipeline parameters used
}
}
\description{
Performs Morse-Smale segmentation followed by a single Bayesian boundary refinement
using optimized parameters proven to achieve >0.85 Adjusted Rand Index.
}
\examples{
\dontrun{
# Simplest usage with defaults (proven to achieve >0.85 ARI)
result <- TTS_pipeline(las = my_las_data)

# With custom Bayesian parameters
result <- TTS_pipeline(
  las = my_las_data,
  prior_strength = 1.0,       # Moderate spatial consistency
  likelihood_strength = 1.6,   # Strong elevation consistency
  confidence_threshold = 1.0   # Aggressive refinement
)

# Validate results (if ground truth available)
if ("treeid" \%in\% names(my_las_data@data)) {
  validate_TTS(result, my_las_data)
}

# Visualize in 3D
plot_TTS_3d(result)
}

}
